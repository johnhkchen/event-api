# Development Nginx Configuration
# Routes requests to locally running services during development

events {
    worker_connections 1024;
}

http {
    upstream hono_api {
        server host.docker.internal:3001;  # Local Hono service
    }
    
    upstream elixir_service {
        server host.docker.internal:4001;  # Local Elixir service
    }
    
    upstream baml_service {
        server host.docker.internal:8081;  # Local BAML service
    }

    # Hono API Service
    server {
        listen 3000;
        server_name localhost;
        
        location / {
            proxy_pass http://hono_api;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Elixir Processing Service  
    server {
        listen 4000;
        server_name localhost;
        
        location / {
            proxy_pass http://elixir_service;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # BAML AI Service
    server {
        listen 8080;
        server_name localhost;
        
        location / {
            proxy_pass http://baml_service;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }
}